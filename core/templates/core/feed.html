{% extends "base.html" %}

{% block title %}Community Feed{% endblock %}

{% block content %}
<div class="feed-container">
  <h2 class="feed-title">ğŸŒ Community Feed</h2>

  {% if user.is_authenticated %}
    <div class="create-post-card create-post">
      <h3>Share Your Thoughts</h3>
      <form action="{% url 'feed' %}" method="POST">
        {% csrf_token %}
        {{ form.as_p }}
        <button type="submit" class="btn primary">â• Post</button>
      </form>
    </div>
  {% else %}
    <p class="text-center login-prompt">
      <a href="{% url 'login' %}" class="btn primary">Log in</a> to share your thoughts!
    </p>
  {% endif %}

  <div class="posts-list">
    {% for post in posts %}
      <div class="post-card {% if post.like_count > 10 %}post-most-liked{% endif %}">
        <div class="post-header">
          <strong>{{ post.user.username }}</strong>
          <small class="post-date">{{ post.created_at|date:"F j, Y, g:i a" }}</small>
        </div>

        <div class="post-body">
          <p>{{ post.content }}</p>
        </div>

        <div class="post-footer">
          {% if user.is_authenticated %}
            <form action="{% url 'like_post' post.id %}" method="POST" style="display:inline;">
              {% csrf_token %}
              <button type="submit" class="btn-action like-btn">
                ğŸ‘ Like ({{ post.like_count }})
              </button>
              
            </form>
            <form action="{% url 'dislike_post' post.id %}" method="POST" style="display:inline;">
              {% csrf_token %}
              <button type="submit" class="btn-action dislike-btn">
                ğŸ‘ Dislike ({{ post.dislike_count }})
              </button>
            </form>
          {% endif %}
          <button class="toggle-comments-btn" onclick="toggleComments('comments-{{ post.id }}')">
            ğŸ’¬ Comments ({{ post.comment_count }})
          </button>
        </div>

        <div id="comments-{{ post.id }}" class="comments hidden">
          {% for comment in post.comments.all %}
            <div class="comment {% if comment.like_count > 5 %}highlight-support{% endif %}">
              <strong>{{ comment.user.username }}</strong>: {{ comment.content }}
              <small>{{ comment.created_at|date:"F j, Y, g:i a" }}</small>
            </div>
          {% empty %}
            <p>No comments yet.</p>
          {% endfor %}
        </div>
      </div>
    {% empty %}
      <p class="empty-feed-text">No posts yet. Be the first to share!</p>
    {% endfor %}
  </div>
</div>

<script>
function toggleComments(id) {
  const section = document.getElementById(id);
  section.classList.toggle("hidden");
}
</script>
{% endblock %}

