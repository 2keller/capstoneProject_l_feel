{% extends "base.html" %}

{% block title %}Community Feed{% endblock %}

{% block content %}
<h2>Community Feed</h2>

{% if user.is_authenticated %}
    <form action="{% url 'create_post' %}" method="POST" style="margin-bottom: 1.5rem; padding: 15px; border: 1px solid #eee;">
        {% csrf_token %}
        <h3>Share Your Thoughts</h3>
        {{ form.as_p }} <button type="submit" class="btn-primary">➕ Post</button>
    </form>
{% else %}
    <p><a href="{% url 'login' %}">Log in</a> to share your thoughts!</p>
{% endif %}

{% for post in posts %}
    <div class="post">
        <div class="post-actions">
            {% if user.is_authenticated %}
                <form action="{% url 'like_post' post.id %}" method="POST" style="display:inline;">
                    {% csrf_token %}
                    <button type="submit" class="btn-action like-btn">
                        👍 Like ({{ post.like_count }})
                    </button>
                </form>
                <form action="{% url 'dislike_post' post.id %}" method="POST" style="display:inline;">
                    {% csrf_token %}
                    <button type="submit" class="btn-action dislike-btn">
                        👎 Dislike ({{ post.dislike_count }})
                    </button>
                </form>
            {% endif %}
        </div>

        <button class="toggle-comments-btn" onclick="toggleComments('comments-{{ post.id }}')">
            💬 Show Comments ({{ post.comment_count }})
        </button>
        
        </div>
{% empty %}
    <p>No posts yet. Be the first to share!</p>
{% endfor %}

{% endblock %}
